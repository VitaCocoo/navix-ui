<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¯åº—æ™ºèƒ½å†³ç­– - è¿è¥æŒ‡æŒ¥èˆ±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tech-bg': '#0B0F19',
                        'tech-card': '#151B2B',
                        'neon-blue': '#00F0FF',
                        'neon-purple': '#BC13FE',
                        'neon-green': '#0AFF99',
                        'neon-red': '#FF2A6D',
                    },
                    boxShadow: {
                        'neon-blue': '0 0 10px rgba(0, 240, 255, 0.5)',
                        'neon-purple': '0 0 10px rgba(188, 19, 254, 0.5)',
                    },
                    fontFamily: {
                        'sans': ['Microsoft YaHei', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0B0F19;
            color: #e2e8f0;
            font-family: 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        /* Glassmorphism */
        .glass-panel {
            background: rgba(21, 27, 43, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #0B0F19;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 2px;
        }
        /* Chart Constraints */
        .chart-container {
            position: relative;
            height: 220px; /* Fixed height for mobile */
            width: 100%;
            overflow: hidden;
        }
        /* Sticky Tabs */
        .sticky-tabs {
            position: sticky;
            top: 0;
            z-index: 40;
            background: rgba(11, 15, 25, 0.95);
            backdrop-filter: blur(5px);
        }
        .typewriter::after {
            content: '|';
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
    </style>
</head>
<body class="pb-24">

    <!-- Main Dashboard -->
    <main id="dashboard-view" class="pt-4 px-4 space-y-5">

        <!-- Date & T+1 Badge -->
        <div class="flex items-center justify-between bg-slate-800/40 px-3 py-2 rounded-lg border border-white/5">
            <div class="flex items-center space-x-2">
                <i class="fa-regular fa-calendar text-neon-blue text-xs"></i>
                <span class="text-xs text-slate-400">æ•°æ®æ—¥æœŸï¼š</span>
                <span class="text-xs text-white font-medium">2026-01-13 (æ˜¨æ—¥)</span>
            </div>
            <span class="text-[10px] text-slate-500 bg-slate-700/50 px-2 py-0.5 rounded">T+1 æ•°æ®</span>
        </div>

        <!-- Metrics Cards (Horizontal Scroll) -->
        <div id="metrics-scroll-container" class="flex overflow-x-auto whitespace-nowrap pb-2 -mx-4 px-4 space-x-3 scrollbar-hide">
            <!-- Dynamic Content -->
        </div>

        <!-- Intelligence Tab Panel -->
        <section class="flex flex-col relative min-h-[500px]">
            <!-- Sticky Headers -->
            <div class="sticky-tabs flex border-b border-white/10 mb-4 pt-2">
                <button onclick="switchHomeTab('supervision')" id="tab-home-supervision" class="flex-1 py-3 text-center text-xs font-bold text-neon-blue border-b-2 border-neon-blue transition-all">
                    ä»»åŠ¡
                </button>
                <button onclick="switchHomeTab('insights')" id="tab-home-insights" class="flex-1 py-3 text-center text-xs font-bold text-slate-400 border-b-2 border-transparent hover:text-white transition-all">
                    æ´å¯Ÿ
                </button>
                <button onclick="switchHomeTab('cases')" id="tab-home-cases" class="flex-1 py-3 text-center text-xs font-bold text-slate-400 border-b-2 border-transparent hover:text-white transition-all">
                    æ¡ˆä¾‹
                </button>
            </div>

            <!-- Tab Content -->
            
            <!-- 1. Supervision Tasks -->
            <div id="panel-home-supervision" class="animate-fade-in pb-20">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[10px] text-slate-500">å½“å‰ä»»åŠ¡ (3/3)</span>
                    <button onclick="openCreateTaskView()" class="text-[10px] text-neon-blue border border-neon-blue/30 px-2 py-1 rounded hover:bg-neon-blue/10 transition-colors">
                        <i class="fa-solid fa-plus mr-1"></i> æ–°å¢ä»»åŠ¡
                    </button>
                </div>
                <div id="supervision-task-list" class="space-y-3">
                    <!-- Tasks Rendered by JS -->
                </div>
            </div>

            <!-- 2. Insights -->
            <div id="panel-home-insights" class="hidden animate-fade-in pb-20">
                
                <!-- Sub-tabs for Insights -->
                <div class="flex space-x-2 mb-4 bg-white/5 p-1 rounded-lg">
                    <button onclick="switchInsightsSubTab('keywords')" id="tab-insights-keywords" class="flex-1 py-2 text-center text-xs font-medium text-white bg-neon-blue/20 border border-neon-blue/30 rounded-md transition-all">
                        çƒ­è¯
                    </button>
                    <button onclick="switchInsightsSubTab('sentiment')" id="tab-insights-sentiment" class="flex-1 py-2 text-center text-xs font-medium text-slate-400 bg-transparent rounded-md transition-all">
                        èˆ†æƒ…
                    </button>
                </div>

                <!-- Keywords Section -->
                <div id="insights-keywords" class="space-y-3">
                    <!-- Dynamic List -->
                </div>

                <!-- Sentiment Section -->
                <div id="insights-sentiment" class="hidden">
                    <!-- Filter Tags -->
                    <div class="flex flex-wrap gap-2 mb-4 bg-white/5 p-2 rounded-lg">
                        <button onclick="filterSentiments('all')" id="filter-all" class="px-3 py-1.5 text-xs font-medium rounded-full bg-neon-blue/20 text-neon-blue border border-neon-blue/30 transition-all">
                            å…¨éƒ¨
                        </button>
                        <button onclick="filterSentiments('complaint')" id="filter-complaint" class="px-3 py-1.5 text-xs font-medium rounded-full bg-transparent text-slate-400 border border-white/10 hover:border-neon-red/30 hover:text-neon-red transition-all">
                            æŠ•è¯‰
                        </button>
                        <button onclick="filterSentiments('risk')" id="filter-risk" class="px-3 py-1.5 text-xs font-medium rounded-full bg-transparent text-slate-400 border border-white/10 hover:border-orange-400/30 hover:text-orange-400 transition-all">
                            é£é™©
                        </button>
                        <button onclick="filterSentiments('praise')" id="filter-praise" class="px-3 py-1.5 text-xs font-medium rounded-full bg-transparent text-slate-400 border border-white/10 hover:border-neon-green/30 hover:text-neon-green transition-all">
                            å¥½è¯„
                        </button>
                        <button onclick="filterSentiments('anomaly')" id="filter-anomaly" class="px-3 py-1.5 text-xs font-medium rounded-full bg-transparent text-slate-400 border border-white/10 hover:border-yellow-400/30 hover:text-yellow-400 transition-all">
                            å¼‚å¸¸
                        </button>
                    </div>
                    
                    <!-- Sentiment Cards List -->
                    <div id="sentiment-cards-container" class="space-y-3">
                        <!-- Dynamic Sentiment Cards -->
                    </div>
                </div>
            </div>

            <!-- 3. Excellent Cases -->
            <div id="panel-home-cases" class="hidden animate-fade-in pb-20">
                <div class="text-[10px] text-slate-500 mb-3 text-center">æ˜¨æ—¥ä¼˜ç§€è¯æœ¯ç²¾é€‰</div>
                <div id="cases-list" class="space-y-4">
                    <!-- Dynamic Cases -->
                </div>
            </div>

        </section>
    </main>

    <!-- Profile View -->
    <main id="profile-view" class="hidden pt-4 px-4 space-y-5 pb-24">
        
        <!-- User Profile Card -->
        <div class="glass-panel rounded-xl p-5 border border-white/5 relative overflow-hidden">
            <!-- Decorative Background -->
            <div class="absolute top-0 right-0 w-20 h-20 bg-neon-blue/10 blur-xl rounded-full -mr-10 -mt-10"></div>
            
            <div class="relative z-10 flex items-center space-x-4">
                <!-- Avatar -->
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-neon-blue to-neon-purple p-0.5">
                    <div class="w-full h-full rounded-full bg-slate-800 flex items-center justify-center">
                        <i class="fa-solid fa-user text-2xl text-neon-blue"></i>
                    </div>
                </div>
                
                <!-- User Info -->
                <div class="flex-1">
                    <h2 class="text-lg font-bold text-white mb-1">å¼ æ€»</h2>
                    <div class="flex items-center space-x-2">
                        <span class="text-[10px] bg-neon-blue/20 text-neon-blue px-2 py-0.5 rounded-full border border-neon-blue/30">è¿è¥ç®¡ç†è€…</span>
                        <span class="text-xs text-slate-400">å¤§å‚æ—è¿é”è¯åº—</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="grid grid-cols-2 gap-3">
            <div class="glass-panel rounded-xl p-3 border border-white/5 text-center">
                <div class="text-xs text-slate-400 mb-1">é—¨åº—æ•°</div>
                <div class="text-xl font-bold text-white font-mono">18</div>
            </div>
            <div class="glass-panel rounded-xl p-3 border border-white/5 text-center">
                <div class="text-xs text-slate-400 mb-1">è®¾å¤‡æ•°</div>
                <div class="text-xl font-bold text-white font-mono">120</div>
            </div>
        </div>

        <!-- Menu List -->
        <div class="space-y-3">
            <!-- Removed: Enterprise Info, System Settings, About System -->
        </div>

        <!-- Logout Button -->
        <button onclick="handleLogout()" class="w-full glass-panel rounded-xl p-4 border border-neon-red/20 flex items-center justify-center space-x-2 active:scale-95 transition-transform mt-8">
            <i class="fa-solid fa-right-from-bracket text-neon-red"></i>
            <span class="text-sm text-neon-red font-medium">é€€å‡ºç™»å½•</span>
        </button>

        <!-- Version Info -->
        <div class="text-center text-[10px] text-slate-600 pt-4 pb-2">
            è¯åº—æ™ºèƒ½å†³ç­–ç³»ç»Ÿ v1.2.0
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 w-full h-16 bg-[#0B0F19]/95 backdrop-blur border-t border-white/10 flex z-50">
        <button onclick="switchMainTab('dashboard')" id="nav-item-dashboard" class="flex-1 flex flex-col items-center justify-center space-y-1 text-neon-blue">
            <i class="fa-solid fa-house text-lg drop-shadow-[0_0_5px_rgba(0,240,255,0.5)]"></i>
            <span class="text-[10px] font-medium">é©¾é©¶èˆ±</span>
        </button>
        <button onclick="switchMainTab('profile')" id="nav-item-profile" class="flex-1 flex flex-col items-center justify-center space-y-1 text-slate-500 hover:text-white transition-colors">
            <i class="fa-solid fa-user-gear text-lg"></i>
            <span class="text-[10px]">æˆ‘çš„</span>
        </button>
    </nav>

    <!-- Create Task View (Slide-in Page) -->
    <div id="create-task-view" class="fixed inset-0 bg-[#0B0F19] z-[60] transform translate-x-full transition-transform duration-300 flex flex-col">
        <header class="h-14 border-b border-white/10 flex items-center justify-between px-4 bg-[#0B0F19]">
            <button onclick="hideCreateTaskView()" class="w-8 h-8 flex items-center justify-center text-slate-400">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h1 id="create-task-title" class="text-sm font-bold text-white">æ–°å»ºä»»åŠ¡</h1>
            <div class="w-8"></div>
        </header>
        
        <div class="flex-1 p-5 overflow-y-auto" id="create-task-body">
            <div class="space-y-6">
                
                <!-- AI Description Input -->
                <div id="ai-input-section" class="relative">
                    <label class="block text-xs text-neon-blue font-bold mb-2">è¯·è¾“å…¥ç›‘æ§éœ€æ±‚</label>
                    <div class="relative">
                        <textarea id="ai-input-desc" rows="4" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³æŠ“ä¸€ä¸‹æœ‰æ²¡æœ‰æ¨èæ–°å“ç›Šç”ŸèŒ..." class="w-full bg-slate-800/50 border border-white/10 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-neon-blue/50 transition-colors resize-none"></textarea>
                    </div>
                    
                    <!-- Quick Cases -->
                    <div class="mt-3">
                        <div class="text-[10px] text-slate-500 mb-2">æ¨èæ¡ˆä¾‹ï¼š</div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="fillInput('æŸ¥ä¸€ä¸‹è°å–æ„Ÿå†’è¯æ²¡æ¨ç»´C')" class="text-[10px] bg-slate-800 text-slate-300 px-3 py-1.5 rounded-full border border-white/5 hover:border-neon-blue/30 transition-colors">å…³è”ç»´C</button>
                            <button onclick="fillInput('æ£€æŸ¥æ˜¯å¦è¯´äº†æ¬¢è¿å…‰ä¸´')" class="text-[10px] bg-slate-800 text-slate-300 px-3 py-1.5 rounded-full border border-white/5 hover:border-neon-blue/30 transition-colors">æ¬¢è¿è¯­åˆè§„</button>
                            <button onclick="fillInput('æœ‰æ²¡æœ‰å‘ä¼šå‘˜ä»‹ç»ç§¯åˆ†æŠµæ‰£')" class="text-[10px] bg-slate-800 text-slate-300 px-3 py-1.5 rounded-full border border-white/5 hover:border-neon-blue/30 transition-colors">ä¼šå‘˜æƒç›Š</button>
                        </div>
                    </div>
                </div>

                <!-- Generated Result (Hidden initially) -->
                <div id="generated-result-area" class="hidden space-y-5 animate-fade-in border-t border-white/10 pt-5">
                    
                    <!-- Field 1: Name -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs text-slate-400">ä»»åŠ¡åç§°</label>
                            <div class="flex items-center space-x-2">
                                <span id="task-name-count" class="text-[10px] text-slate-500"><span class="text-neon-blue">0</span>/20</span>
                                <button onclick="regenerateField('task-name')" class="text-[10px] text-neon-blue hover:text-white"><i class="fa-solid fa-rotate-right mr-1"></i>é‡å†™</button>
                            </div>
                        </div>
                        <input type="text" id="task-name" value="" maxlength="20" oninput="updateCharCount('task-name', 20)" class="w-full bg-slate-800/50 border border-white/10 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-neon-blue/50 transition-colors">
                    </div>

                    <!-- Field 2: Intro -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs text-slate-400">ä»»åŠ¡è¦æ±‚</label>
                            <div class="flex items-center space-x-2">
                                <span id="task-intro-count" class="text-[10px] text-slate-500"><span class="text-neon-blue">0</span>/100</span>
                                <button onclick="regenerateField('task-intro')" class="text-[10px] text-neon-blue hover:text-white"><i class="fa-solid fa-rotate-right mr-1"></i>é‡å†™</button>
                            </div>
                        </div>
                        <textarea id="task-intro" rows="2" maxlength="100" oninput="updateCharCount('task-intro', 100)" class="w-full bg-slate-800/50 border border-white/10 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-neon-blue/50 transition-colors resize-none"></textarea>
                    </div>

                    <!-- Field 3: Action Plan -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-xs text-slate-400">ä»»åŠ¡æ¡ˆä¾‹</label>
                            <div class="flex items-center space-x-2">
                                <span id="task-action-count" class="text-[10px] text-slate-500"><span class="text-neon-blue">0</span>/200</span>
                                <button onclick="regenerateField('task-action')" class="text-[10px] text-neon-blue hover:text-white"><i class="fa-solid fa-rotate-right mr-1"></i>é‡å†™</button>
                            </div>
                        </div>
                        <textarea id="task-action" rows="3" maxlength="200" oninput="updateCharCount('task-action', 200)" class="w-full bg-slate-800/50 border border-white/10 rounded-lg px-4 py-3 text-sm text-white focus:outline-none focus:border-neon-blue/50 transition-colors resize-none"></textarea>
                    </div>

                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="p-4 border-t border-white/10 bg-[#0B0F19]">
            <!-- State 1: Generate -->
            <button id="btn-initial-generate" onclick="triggerGenerate()" class="w-full bg-neon-blue text-black font-bold py-3 rounded-lg shadow-[0_0_15px_rgba(0,240,255,0.3)] active:scale-95 transition-transform flex items-center justify-center">
                <i class="fa-solid fa-wand-magic-sparkles mr-2"></i> ç”Ÿæˆ
            </button>

            <!-- State 2: Save & Regenerate (Hidden) -->
            <div id="btn-group-generated" class="hidden flex space-x-3">
                <button onclick="resetGenerate()" class="flex-1 bg-slate-800 text-slate-300 font-bold py-3 rounded-lg border border-white/10 active:scale-95 transition-transform">
                    <i class="fa-solid fa-rotate mr-1"></i> é‡æ–°ç”Ÿæˆ
                </button>
                <button id="btn-save-task" onclick="saveNewTask()" class="flex-[2] bg-neon-blue text-black font-bold py-3 rounded-lg shadow-[0_0_15px_rgba(0,240,255,0.3)] active:scale-95 transition-transform">
                    <i class="fa-solid fa-check mr-1"></i> ä¿å­˜æŒ‡æ ‡
                </button>
            </div>
        </div>
    </div>

    <!-- Metric Detail View (Slide-in Page) -->
    <div id="metric-detail-view" class="fixed inset-0 bg-[#0B0F19] z-[65] transform translate-x-full transition-transform duration-300 flex flex-col">
        <header class="h-14 border-b border-white/10 flex items-center justify-between px-4 bg-[#0B0F19]">
            <button onclick="hideMetricDetailView()" class="w-8 h-8 flex items-center justify-center text-slate-400">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h1 class="text-sm font-bold text-white">æŒ‡æ ‡è¯¦æƒ…</h1>
            <div class="w-8"></div>
        </header>

        <div class="flex-1 overflow-y-auto">
            <!-- Header Card -->
            <div class="p-4 bg-gradient-to-b from-slate-800/30 to-[#0B0F19] border-b border-white/5">
                <div class="text-center mb-4">
                    <h2 id="metric-detail-title" class="text-2xl font-bold text-white mb-3">...</h2>
                    <div id="metric-detail-value" class="text-4xl font-bold text-neon-blue font-mono mb-3">...</div>
                    <div id="metric-detail-change" class="flex items-center justify-center text-sm">
                        <!-- Dynamic content -->
                    </div>
                </div>
                
                <!-- Warning for Traffic Metric -->
                <div id="metric-warning" class="hidden mt-4 glass-panel p-3 rounded-lg border border-yellow-400/20 bg-yellow-400/5">
                    <div class="flex items-start space-x-2">
                        <i class="fa-solid fa-lightbulb text-yellow-400 mt-0.5"></i>
                        <div class="text-xs text-slate-300">å®¢æµé‡æ•°æ®é€šè¿‡è¯­éŸ³æ•°æ®è·å–ï¼Œå­˜åœ¨ä¸€å®šè¯¯å·®</div>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="p-4 border-b border-white/5">
                <div class="flex items-center justify-between mb-3">
                    <h3 id="metric-chart-title" class="text-xs font-bold text-white border-l-2 border-neon-blue pl-2">è¿‘7æ—¥è¶‹åŠ¿</h3>
                </div>
                
                <!-- Trend Switch Buttons (Only for Traffic Metric) -->
                <div id="trend-switch-container" class="hidden flex space-x-2 mb-4 bg-white/5 p-1 rounded-lg">
                    <button onclick="switchMetricTrend('7days')" id="btn-trend-7days" class="flex-1 py-2 text-center text-xs font-medium text-white bg-neon-blue/20 border border-neon-blue/30 rounded-md transition-all">
                        7æ—¥è¶‹åŠ¿
                    </button>
                    <button onclick="switchMetricTrend('hourly')" id="btn-trend-hourly" class="flex-1 py-2 text-center text-xs font-medium text-slate-400 bg-transparent rounded-md transition-all">
                        æ˜¨æ—¥åˆ†æ—¶è¶‹åŠ¿
                    </button>
                </div>
                
                <div class="chart-container" style="height: 200px;">
                    <canvas id="metric-detail-chart"></canvas>
                </div>
            </div>

            <!-- Store Ranking -->
            <div class="p-4 pb-20">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs font-bold text-white border-l-2 border-neon-blue pl-2">é—¨åº—æ’è¡Œæ¦œ</h3>
                    <span class="text-[10px] text-slate-500">æ˜¨æ—¥æ•°æ®</span>
                </div>
                <div id="metric-store-list" class="space-y-2">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Task Detail View (Slide-in Page) -->
    <div id="task-detail-view" class="fixed inset-0 bg-[#0B0F19] z-[65] transform translate-x-full transition-transform duration-300 flex flex-col">
        <header class="h-14 border-b border-white/10 flex items-center justify-between px-4 bg-[#0B0F19]">
            <button onclick="hideTaskDetailView()" class="w-8 h-8 flex items-center justify-center text-slate-400">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h1 class="text-sm font-bold text-white">ä»»åŠ¡è¯¦æƒ…</h1>
            <div class="w-8"></div>
        </header>

        <div class="flex-1 overflow-y-auto">
            <!-- Header Card -->
            <div class="p-4 bg-gradient-to-b from-slate-800/30 to-[#0B0F19] border-b border-white/5">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <h2 id="detail-task-title" class="text-lg font-bold text-white mb-1">...</h2>
                    </div>
                    <div class="text-right flex flex-col items-end">
                         <button onclick="openTaskShareModal(currentDetailTaskId)" class="mb-2 text-neon-blue bg-neon-blue/10 w-8 h-8 rounded-full flex items-center justify-center hover:bg-neon-blue/20 transition-colors">
                                <i class="fa-solid fa-share-nodes text-xs"></i>
                         </button>
                         <div class="text-[10px] text-slate-500 mb-0.5">æ˜¨æ—¥æ‰§è¡Œç‡</div>
                         <div id="detail-task-value" class="text-2xl font-bold text-neon-blue font-mono">--%</div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="glass-panel p-3 rounded-lg border border-white/5">
                        <div class="text-[10px] text-slate-500 mb-1">ä»»åŠ¡è¦æ±‚</div>
                        <div id="detail-task-intro" class="text-xs text-slate-300 leading-relaxed">...</div>
                    </div>
                    <div class="glass-panel p-3 rounded-lg border border-white/5">
                        <div class="text-[10px] text-slate-500 mb-1">ä»»åŠ¡æ¡ˆä¾‹ (SOP)</div>
                        <div id="detail-task-action" class="text-xs text-slate-300 leading-relaxed">...</div>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="p-4 border-b border-white/5">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs font-bold text-white border-l-2 border-neon-blue pl-2">è¿‘7æ—¥è¶‹åŠ¿</h3>
                </div>
                <div class="chart-container" style="height: 200px;">
                    <canvas id="detail-task-chart"></canvas>
                </div>
            </div>

            <!-- Store Ranking -->
            <div class="p-4 pb-20">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-xs font-bold text-white border-l-2 border-neon-blue pl-2">é—¨åº—æ‰§è¡Œçº¢é»‘æ¦œ</h3>
                    <span class="text-[10px] text-slate-500">æ˜¨æ—¥æ•°æ®</span>
                </div>
                <div id="detail-store-list" class="space-y-2">
                    <!-- Dynamic Content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Case Detail View (Slide-in Page) -->
    <div id="case-detail-view" class="fixed inset-0 bg-[#0B0F19] z-[65] transform translate-x-full transition-transform duration-300 flex flex-col">
        <header class="h-14 border-b border-white/10 flex items-center justify-between px-4 bg-[#0B0F19]">
            <button onclick="hideCaseDetailView()" class="w-8 h-8 flex items-center justify-center text-slate-400">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h1 class="text-sm font-bold text-white">æ¡ˆä¾‹è¯¦æƒ…</h1>
            <div class="w-8"></div>
        </header>

        <div class="flex-1 overflow-y-auto pb-24">
            <!-- Hero Card (Staff) -->
            <div class="p-5 bg-gradient-to-b from-slate-800/40 to-[#0B0F19]">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-slate-700 border-2 border-neon-blue p-0.5">
                            <img src="" id="case-detail-avatar" class="w-full h-full rounded-full object-cover">
                        </div>
                        <div>
                            <div class="flex items-center space-x-2">
                                <h2 id="case-detail-name" class="text-lg font-bold text-white">...</h2>
                                <span id="case-detail-store" class="text-[10px] text-slate-400 bg-white/5 px-2 py-0.5 rounded-full">...</span>
                            </div>
                            <div id="case-detail-tag" class="text-xs text-neon-blue mt-1">...</div>
                        </div>
                    </div>
                </div>

                <!-- AI Insight -->
                <div class="glass-panel p-4 rounded-xl border border-neon-blue/20 relative overflow-hidden mb-4">
                    <div class="absolute top-0 left-0 w-1 h-full bg-neon-blue"></div>
                    <div class="flex items-start space-x-3">
                        <i class="fa-solid fa-wand-magic-sparkles text-neon-blue mt-1"></i>
                        <div>
                            <div class="text-xs font-bold text-white mb-1">AI äº®ç‚¹ç‚¹è¯„</div>
                            <p id="case-detail-reason" class="text-xs text-slate-300 leading-relaxed">...</p>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Transcript -->
            <div class="px-4">
                <div class="text-xs font-bold text-slate-500 mb-3 ml-1">å¯¹è¯è®°å½•</div>
                <div id="case-transcript-list" class="space-y-4">
                    <!-- Chat Bubbles -->
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="fixed bottom-0 w-full p-4 bg-[#0B0F19]/95 backdrop-blur border-t border-white/10 flex z-[70]">
             <button onclick="openCaseShareModal()" class="w-full bg-neon-blue text-black font-bold py-3 rounded-lg shadow-[0_0_15px_rgba(0,240,255,0.3)] active:scale-95 transition-transform flex items-center justify-center">
                <i class="fa-solid fa-share-nodes mr-2"></i> åˆ†äº«ä¼˜ç§€æ¡ˆä¾‹
            </button>
        </div>
    </div>

    <!-- Share Task Modal (Floating Window) -->
    <div id="share-task-modal" class="fixed inset-0 bg-black/80 z-[80] hidden flex items-center justify-center p-6 animate-fade-in">
        <div class="bg-[#151B2B] rounded-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Header -->
            <div class="flex justify-between items-center p-4 border-b border-white/10">
                <h3 class="text-sm font-bold text-white">ä»»åŠ¡åˆ†äº«é¢„è§ˆ</h3>
                <button onclick="closeTaskShareModal()" class="text-slate-400 hover:text-white">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <!-- Poster Preview Area -->
            <div class="p-4 overflow-y-auto flex-1 bg-slate-900/50">
                <div id="task-poster-node" class="bg-gradient-to-br from-slate-800 to-[#0B0F19] border border-white/10 rounded-xl p-5 shadow-2xl relative overflow-hidden">
                    <!-- Decorative Elements -->
                    <div class="absolute top-0 right-0 w-20 h-20 bg-neon-blue/10 blur-xl rounded-full -mr-10 -mt-10"></div>
                    <div class="absolute bottom-0 left-0 w-20 h-20 bg-neon-purple/10 blur-xl rounded-full -ml-10 -mb-10"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10 text-center space-y-4">
                        <div class="inline-block px-3 py-1 rounded-full border border-neon-blue/30 text-neon-blue text-[10px] bg-neon-blue/5 mb-2">
                            <i class="fa-solid fa-bullseye mr-1"></i> é‡ç‚¹ä»»åŠ¡
                        </div>
                        <h2 id="poster-task-title" class="text-xl font-bold text-white leading-tight">...</h2>
                        
                        <div class="w-full h-px bg-gradient-to-r from-transparent via-white/20 to-transparent my-4"></div>
                        
                        <div class="text-left bg-white/5 rounded-lg p-3 border border-white/5">
                            <div class="text-[10px] text-slate-400 mb-1">æ‰§è¡Œæ–¹æ¡ˆ (SOP)</div>
                            <div id="poster-task-desc" class="text-sm text-slate-200 leading-relaxed font-medium">...</div>
                        </div>

                        <div class="pt-4 flex justify-between items-end">
                             <div class="text-left">
                                 <div class="text-[10px] text-slate-500">å‘å¸ƒæ—¶é—´</div>
                                 <div id="poster-create-time" class="text-xs text-slate-300 font-mono">...</div>
                             </div>
                             <div class="text-right">
                                 <div class="text-[10px] text-slate-500">è¯åº—æ™ºèƒ½å†³ç­–ç³»ç»Ÿ</div>
                                 <div class="text-[10px] text-slate-600">Smart Badge System</div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="p-4 border-t border-white/10 bg-[#0B0F19] grid grid-cols-2 gap-3">
                <button onclick="downloadPoster()" class="flex items-center justify-center space-x-2 bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors">
                    <i class="fa-solid fa-download"></i>
                    <span class="text-xs font-bold">ä¿å­˜å›¾ç‰‡</span>
                </button>
                <button onclick="shareToWeChat()" class="flex items-center justify-center space-x-2 bg-green-600 text-white py-3 rounded-lg hover:bg-green-500 transition-colors">
                    <i class="fa-brands fa-weixin"></i>
                    <span class="text-xs font-bold">åˆ†äº«ç»™åº—å‘˜</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Sentiment Detail View (Slide-in Page) -->
    <div id="sentiment-detail-view" class="fixed inset-0 bg-[#0B0F19] z-[65] transform translate-x-full transition-transform duration-300 flex flex-col">
        <header class="h-14 border-b border-white/10 flex items-center justify-between px-4 bg-[#0B0F19]">
            <button onclick="hideSentimentDetailView()" class="w-8 h-8 flex items-center justify-center text-slate-400">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h1 class="text-sm font-bold text-white">èˆ†æƒ…è¯¦æƒ…</h1>
            <div class="w-8"></div>
        </header>

        <div class="flex-1 overflow-y-auto pb-24">
            <!-- Header Card -->
            <div class="p-5 bg-gradient-to-b from-slate-800/40 to-[#0B0F19] border-b border-white/5">
                <!-- Type & Priority -->
                <div class="flex items-center space-x-2 mb-3">
                    <span id="sentiment-type-tag" class="text-xs font-bold px-3 py-1 rounded-full">...</span>
                    <span id="sentiment-priority" class="text-sm">...</span>
                </div>

                <!-- Title -->
                <h2 id="sentiment-title" class="text-lg font-bold text-white mb-3">...</h2>

                <!-- Meta Info -->
                <div class="flex items-center justify-between text-xs text-slate-400 mb-4">
                    <div class="flex items-center space-x-4">
                        <span><i class="fa-regular fa-clock mr-1"></i><span id="sentiment-time">...</span></span>
                        <span><i class="fa-solid fa-store mr-1"></i><span id="sentiment-store">...</span></span>
                    </div>
                </div>

                <!-- Staff Info -->
                <div class="flex items-center space-x-3 bg-white/5 p-3 rounded-lg">
                    <div class="w-10 h-10 rounded-full bg-slate-700 border border-white/10 overflow-hidden">
                        <img src="" id="sentiment-staff-avatar" class="w-full h-full object-cover">
                    </div>
                    <div>
                        <div class="text-sm font-medium text-white" id="sentiment-staff-name">...</div>
                        <div class="text-[10px] text-slate-400">å½“äº‹å‘˜å·¥</div>
                    </div>
                </div>
            </div>

            <!-- Event Summary -->
            <div class="p-4 border-b border-white/5">
                <h3 class="text-xs font-bold text-white border-l-2 border-neon-blue pl-2 mb-3">äº‹ä»¶è¯¦æƒ…</h3>
                <div class="glass-panel p-4 rounded-lg">
                    <div id="sentiment-summary" class="text-sm text-slate-300 leading-relaxed">...</div>
                </div>
            </div>

            <!-- Conversation Transcript -->
            <div class="p-4 pb-20">
                <h3 class="text-xs font-bold text-white border-l-2 border-neon-blue pl-2 mb-3">å¯¹è¯è®°å½•</h3>
                <div id="sentiment-transcript" class="space-y-3">
                    <!-- Transcript bubbles -->
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="fixed bottom-0 w-full p-4 bg-[#0B0F19]/95 backdrop-blur border-t border-white/10 z-[70]">
            <button onclick="openSentimentShareModal()" class="w-full bg-neon-blue text-black font-bold py-3 rounded-lg shadow-[0_0_15px_rgba(0,240,255,0.3)] active:scale-95 transition-transform flex items-center justify-center">
                <i class="fa-solid fa-share-nodes mr-2"></i> åˆ†äº«
            </button>
        </div>
    </div>

    <!-- Share Sentiment Modal (New) -->
    <div id="share-sentiment-modal" class="fixed inset-0 bg-black/80 z-[80] hidden flex items-center justify-center p-6 animate-fade-in">
        <div class="bg-[#151B2B] rounded-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Header -->
            <div class="flex justify-between items-center p-4 border-b border-white/10">
                <h3 class="text-sm font-bold text-white">èˆ†æƒ…åˆ†äº«é¢„è§ˆ</h3>
                <button onclick="closeSentimentShareModal()" class="text-slate-400 hover:text-white">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <!-- Poster Preview Area -->
            <div class="p-4 overflow-y-auto flex-1 bg-slate-900/50">
                <div id="sentiment-poster-node" class="bg-gradient-to-br from-slate-800 to-[#0B0F19] border border-white/10 rounded-xl p-5 shadow-2xl relative overflow-hidden">
                    <!-- Decorative Elements -->
                    <div class="absolute top-0 right-0 w-24 h-24 bg-neon-red/10 blur-xl rounded-full -mr-10 -mt-10"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10 space-y-4">
                        <!-- Type Badge -->
                        <div class="flex items-center justify-between">
                            <div>
                                <span id="poster-sentiment-type" class="inline-block px-3 py-1 rounded-full text-xs font-bold">...</span>
                                <span id="poster-sentiment-priority" class="ml-2 text-base">...</span>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] text-slate-400">å‘ç”Ÿæ—¶é—´</div>
                                <div id="poster-sentiment-time" class="text-xs text-slate-300 font-mono">...</div>
                            </div>
                        </div>

                        <div class="w-full h-px bg-white/10 my-2"></div>

                        <!-- Title -->
                        <h2 id="poster-sentiment-title" class="text-lg font-bold text-white leading-tight">...</h2>
                        
                        <!-- Staff Info -->
                        <div class="flex items-center space-x-3 bg-white/5 p-3 rounded-lg">
                            <div class="w-10 h-10 rounded-full bg-slate-700 overflow-hidden border border-white/10">
                                <img src="" id="poster-sentiment-avatar" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <div id="poster-sentiment-staff" class="text-sm font-medium text-white">...</div>
                                <div id="poster-sentiment-store" class="text-[10px] text-slate-400">...</div>
                            </div>
                        </div>

                        <!-- Summary -->
                        <div class="glass-panel p-3 rounded-lg border-l-2 border-neon-red">
                            <div class="text-[10px] text-slate-400 mb-1">äº‹ä»¶æ‘˜è¦</div>
                            <div id="poster-sentiment-summary" class="text-xs text-slate-200 leading-relaxed line-clamp-4">...</div>
                        </div>

                        <!-- Key Transcript -->
                        <div class="bg-white/5 rounded-lg p-3">
                            <div class="text-[10px] text-slate-500 mb-2">å…³é”®å¯¹è¯ç‰‡æ®µ</div>
                            <div id="poster-sentiment-transcript" class="space-y-2 text-xs text-slate-300">
                                <!-- Selected transcript -->
                            </div>
                        </div>

                        <div class="pt-4 flex justify-between items-end">
                            <div class="text-left">
                                <div class="text-[10px] text-slate-500">è¯åº—æ™ºèƒ½å†³ç­–ç³»ç»Ÿ</div>
                                <div class="text-[10px] text-slate-600">Smart Badge System</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="p-4 border-t border-white/10 bg-[#0B0F19] grid grid-cols-2 gap-3">
                <button onclick="downloadPoster()" class="flex items-center justify-center space-x-2 bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors">
                    <i class="fa-solid fa-download"></i>
                    <span class="text-xs font-bold">ä¿å­˜å›¾ç‰‡</span>
                </button>
                <button onclick="shareToWeChat()" class="flex items-center justify-center space-x-2 bg-green-600 text-white py-3 rounded-lg hover:bg-green-500 transition-colors">
                    <i class="fa-brands fa-weixin"></i>
                    <span class="text-xs font-bold">åˆ†äº«ç»™åº—é•¿</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Share Case Modal (New) -->
    <div id="share-case-modal" class="fixed inset-0 bg-black/80 z-[80] hidden flex items-center justify-center p-6 animate-fade-in">
        <div class="bg-[#151B2B] rounded-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Header -->
            <div class="flex justify-between items-center p-4 border-b border-white/10">
                <h3 class="text-sm font-bold text-white">æ¡ˆä¾‹åˆ†äº«é¢„è§ˆ</h3>
                <button onclick="closeCaseShareModal()" class="text-slate-400 hover:text-white">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <!-- Poster Preview Area -->
            <div class="p-4 overflow-y-auto flex-1 bg-slate-900/50">
                <div id="case-poster-node" class="bg-gradient-to-br from-[#1e1b4b] to-[#0B0F19] border border-white/10 rounded-xl p-5 shadow-2xl relative overflow-hidden">
                    <!-- Decorative Elements -->
                    <div class="absolute top-0 right-0 w-24 h-24 bg-neon-green/10 blur-xl rounded-full -mr-10 -mt-10"></div>
                    
                    <!-- Content -->
                    <div class="relative z-10 space-y-4">
                        <div class="flex items-center justify-between">
                             <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full bg-slate-700 overflow-hidden border border-white/10">
                                    <img src="" id="poster-case-avatar" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <div id="poster-case-name" class="text-sm font-bold text-white">...</div>
                                    <div id="poster-case-store" class="text-[10px] text-slate-400">...</div>
                                </div>
                             </div>
                             <div class="text-right">
                                 <div class="text-[10px] text-slate-400">æ¥å¾…æ—¶é•¿</div>
                                 <div id="poster-case-duration" class="text-sm font-bold text-white font-mono">...</div>
                             </div>
                        </div>

                        <div class="w-full h-px bg-white/10 my-2"></div>

                        <div class="inline-block px-3 py-1 rounded-full border border-neon-green/30 text-neon-green text-[10px] bg-neon-green/5 mb-1">
                            <i class="fa-solid fa-thumbs-up mr-1"></i> ä¼˜ç§€æ¡ˆä¾‹
                        </div>
                        
                        <div class="glass-panel p-3 rounded-lg border-l-2 border-neon-green">
                            <div class="text-[10px] text-slate-400 mb-1">AI äº®ç‚¹ç‚¹è¯„</div>
                            <div id="poster-case-reason" class="text-sm text-white leading-relaxed font-medium">...</div>
                        </div>

                        <div class="bg-white/5 rounded-lg p-3 flex flex-col">
                            <div class="text-[10px] text-slate-500 mb-2">å¯¹è¯è®°å½•</div>
                             <div id="poster-case-transcript" class="space-y-2 text-xs text-slate-300 max-h-60 overflow-y-auto pr-1">
                                 <!-- Complete conversation transcript -->
                             </div>
                        </div>

                        <div class="pt-4 flex justify-between items-end">
                             <div class="text-left">
                                 <div class="text-[10px] text-slate-500">ä¼šè¯æ—¶é—´</div>
                                 <div id="poster-case-time" class="text-xs text-slate-300 font-mono">...</div>
                             </div>
                             <div class="text-right">
                                 <div class="text-[10px] text-slate-500">è¯åº—æ™ºèƒ½å†³ç­–ç³»ç»Ÿ</div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="p-4 border-t border-white/10 bg-[#0B0F19] grid grid-cols-2 gap-3">
                <button onclick="downloadPoster()" class="flex items-center justify-center space-x-2 bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors">
                    <i class="fa-solid fa-download"></i>
                    <span class="text-xs font-bold">ä¿å­˜å›¾ç‰‡</span>
                </button>
                <button onclick="shareToWeChat()" class="flex items-center justify-center space-x-2 bg-green-600 text-white py-3 rounded-lg hover:bg-green-500 transition-colors">
                    <i class="fa-brands fa-weixin"></i>
                    <span class="text-xs font-bold">åˆ†äº«åˆ°å·¥ä½œç¾¤</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // --- Mock Data ---
        const metricsData = [
            { title: 'å®¢æµé‡', value: '1,250äºº', changeAbs: '+50äºº', changeRel: '+4.2%', isUp: true },
            { title: 'å·¥ç‰Œä½¿ç”¨ç‡', value: '85%', changeAbs: '+5%', changeRel: '+6.2%', isUp: true },
            { title: 'å¹³å‡æ—¶é•¿', value: '7.2h', changeAbs: '-0.5h', changeRel: '-6.5%', isUp: false },
        ];

        const supervisionTasks = [
            { id: 1, title: 'æµæ„Ÿå…³è”ç»´C', desc: 'ä¹°æ„Ÿå†’è¯æ—¶æ¨èç»´ç”Ÿç´ C', value: '68%', changeRel: '+12%', isUp: true, createTime: '2026-01-10' },
            { id: 2, title: 'ä¼šå‘˜æ—¥åŒå€ç§¯åˆ†', desc: 'ç»“è´¦æ—¶æé†’ä¼šå‘˜æƒç›Š', value: '92%', changeRel: '+5%', isUp: true, createTime: '2026-01-11' },
            { id: 3, title: 'æ–°å“ç›Šç”ŸèŒ', desc: 'æŠ—ç”Ÿç´ å…³è”ç›Šç”ŸèŒ', value: '45%', changeRel: '-8%', isUp: false, createTime: '2026-01-12' },
        ];

        const hotWords = [
            { rank: 1, text: 'æ„Ÿå†’çµ', type: 'è¯å“', count: 324, status: 'up' },
            { rank: 2, text: 'å¸ƒæ´›èŠ¬', type: 'è¯å“', count: 289, status: 'stable' },
            { rank: 3, text: 'å’³å—½', type: 'ç—‡çŠ¶', count: 210, status: 'down' },
            { rank: 4, text: 'æµæ„Ÿ', type: 'ç—‡çŠ¶', count: 188, status: 'new' },
            { rank: 5, text: 'ä¼šå‘˜æ—¥', type: 'æ´»åŠ¨', count: 156, status: 'up' },
        ];

        const sentimentData = [
            {
                id: 's1',
                type: 'complaint',
                typeText: 'æŠ•è¯‰',
                priority: 'high',
                priorityIcon: 'ğŸ”¥',
                title: 'é¡¾å®¢æŠ•è¯‰åº—å‘˜æ€åº¦å†·æ¼ ',
                time: '2026-01-13 14:35',
                store: 'ä¸­å¿ƒå¹¿åœºåº—',
                staff: {
                    name: 'å¼ æ™“æ•',
                    avatar: 'https://i.pravatar.cc/150?u=staff1'
                },
                summary: 'é¡¾å®¢å’¨è¯¢å„¿ç«¥æ„Ÿå†’è¯ç”¨æ³•ç”¨é‡æ—¶ï¼Œåº—å‘˜å¼ æ™“æ•å›ç­”ç®€çŸ­ä¸”è¯­æ°”ä¸è€çƒ¦ï¼Œé¡¾å®¢å¤šæ¬¡è¿½é—®ä»æœªè·å¾—æ»¡æ„ç­”å¤ã€‚é¡¾å®¢æƒ…ç»ªæ¿€åŠ¨ï¼Œè¡¨ç¤ºè¦æŠ•è¯‰åˆ°è¯ç›‘å±€ã€‚æœ€ç»ˆé¡¾å®¢æœªè´­ä¹°å•†å“ç¦»åº—ï¼Œå¹¶åœ¨é—¨å£ä¸å…¶ä»–é¡¾å®¢æŠ±æ€¨æ­¤æ¬¡ç»å†ï¼Œé€ æˆä¸è‰¯å½±å“ã€‚',
                riskLevel: 'high',
                transcript: [
                    { role: 'user', text: 'ä½ å¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹è¿™ä¸ªå°å„¿æ„Ÿå†’è¯ï¼Œä¸‰å²å­©å­æ€ä¹ˆåƒï¼Ÿ', time: '14:35:10' },
                    { role: 'staff', text: 'è¯´æ˜ä¹¦ä¸Šå†™ç€å‘¢ã€‚', time: '14:35:15', highlight: true, note: 'å›ç­”æ•·è¡' },
                    { role: 'user', text: 'æˆ‘çŸ¥é“è¯´æ˜ä¹¦ï¼Œä½†æ˜¯æˆ‘æƒ³é—®å¾—è¯¦ç»†ä¸€ç‚¹ï¼Œæ¯”å¦‚é¥­å‰è¿˜æ˜¯é¥­å...', time: '14:35:22' },
                    { role: 'staff', text: 'éƒ½è¡Œã€‚', time: '14:35:26', highlight: true, note: 'æ€åº¦å†·æ·¡' },
                    { role: 'user', text: 'ä½ è¿™ä»€ä¹ˆæ€åº¦å•Šï¼æˆ‘è¦æŠ•è¯‰ä½ ï¼', time: '14:35:35', highlight: true, note: 'é¡¾å®¢æƒ…ç»ªæ¿€åŠ¨' }
                ],
                actionSuggest: 'å»ºè®®åº—é•¿ç«‹å³è‡´ç”µé¡¾å®¢è‡´æ­‰ï¼Œè¯´æ˜å‘˜å·¥çŠ¶æ€ä¸ä½³çš„åŸå› ï¼Œå¹¶æä¾›50å…ƒä»£é‡‘åˆ¸ä½œä¸ºè¡¥å¿ã€‚åŒæ—¶å¯¹å¼ æ™“æ•è¿›è¡Œè°ˆè¯æé†’ã€‚',
                trainingSuggest: 'è¯¥å‘˜å·¥éœ€åŠ å¼ºæœåŠ¡æ„è¯†åŸ¹è®­ï¼Œç‰¹åˆ«æ˜¯é¡¾å®¢å’¨è¯¢åœºæ™¯ä¸‹çš„è€å¿ƒæ²Ÿé€šæŠ€å·§ã€‚å»ºè®®å®‰æ’"å„¿ç«¥ç”¨è¯å¸¸è§é—®é¢˜åº”ç­”"ä¸“é¡¹åŸ¹è®­ã€‚'
            },
            {
                id: 's2',
                type: 'risk',
                typeText: 'é£é™©',
                priority: 'medium',
                priorityIcon: 'âš ï¸',
                title: 'åº—å‘˜æ¨èè¯å“æ—¶æœªè¯¢é—®è¿‡æ•å²',
                time: '2026-01-13 16:20',
                store: 'æ»¨æ±Ÿè·¯åˆ†åº—',
                staff: {
                    name: 'æå¼º',
                    avatar: 'https://i.pravatar.cc/150?u=staff2'
                },
                summary: 'é¡¾å®¢è´­ä¹°å¤´å­¢ç±»æŠ—ç”Ÿç´ æ—¶ï¼Œåº—å‘˜æå¼ºç›´æ¥æ¨èå¹¶æ”¶é“¶ï¼Œå…¨ç¨‹æœªè¯¢é—®é¡¾å®¢æ˜¯å¦æœ‰é’éœ‰ç´ è¿‡æ•å²ã€‚è™½ç„¶é¡¾å®¢æœ¬æ¬¡æœªå‘ç”Ÿä¸è‰¯ååº”ï¼Œä½†æ­¤æ“ä½œè¿åã€Šè¯å“ç»è¥è´¨é‡ç®¡ç†è§„èŒƒã€‹ï¼Œå­˜åœ¨é‡å¤§ç”¨è¯å®‰å…¨éšæ‚£ã€‚',
                riskLevel: 'high',
                transcript: [
                    { role: 'user', text: 'ç»™æˆ‘æ‹¿ç›’å¤´å­¢ã€‚', time: '16:20:05' },
                    { role: 'staff', text: 'è¿™ä¸ªæ•ˆæœå¥½ï¼Œ89å—ã€‚', time: '16:20:10', highlight: true, note: 'æœªè¯¢é—®è¿‡æ•å²' },
                    { role: 'user', text: 'è¡Œï¼Œå¾®ä¿¡ä»˜ã€‚', time: '16:20:15' }
                ],
                actionSuggest: 'ç«‹å³é€šçŸ¥è¯¥åº—é•¿åŠ å¼ºåˆè§„åŸ¹è®­ï¼Œè¦æ±‚æ‰€æœ‰å‘˜å·¥åœ¨é”€å”®å¤„æ–¹è¯æˆ–æŠ—ç”Ÿç´ æ—¶ï¼Œå¿…é¡»è¯¢é—®è¿‡æ•å²å¹¶ç™»è®°ã€‚å»ºè®®å¯¹è¯¥å‘˜å·¥è¿›è¡Œä¹¦é¢è­¦å‘Šã€‚',
                trainingSuggest: 'å…¨å‘˜è¿›è¡Œ"æŠ—ç”Ÿç´ é”€å”®è§„èŒƒæµç¨‹"å¤è®­ï¼Œè€ƒæ ¸åˆæ ¼åæ–¹å¯ä¸Šå²—ã€‚é‡ç‚¹å¼ºè°ƒè¿‡æ•å²è¯¢é—®ç¯èŠ‚çš„æ³•å¾‹é£é™©ã€‚'
            },
            {
                id: 's3',
                type: 'praise',
                typeText: 'å¥½è¯„',
                priority: 'low',
                priorityIcon: 'ğŸ‘',
                title: 'é¡¾å®¢å½“é¢è¡¨æ‰¬åº—å‘˜æœåŠ¡ç»†å¿ƒ',
                time: '2026-01-13 10:45',
                store: 'ä½“è‚²é¦†åº—',
                staff: {
                    name: 'ç‹èŠ³',
                    avatar: 'https://i.pravatar.cc/150?u=staff3'
                },
                summary: 'é¡¾å®¢ä¸ºè€äººè´­ä¹°é™å‹è¯æ—¶ï¼Œåº—å‘˜ç‹èŠ³ä¸»åŠ¨è¯¢é—®è€äººæ˜¯å¦æœ‰å…¶ä»–åŸºç¡€ç–¾ç—…ï¼Œæé†’è¯ç‰©ç¦å¿Œï¼Œå¹¶è¯¦ç»†è®²è§£æœç”¨æ—¶é—´å’Œæ³¨æ„äº‹é¡¹ã€‚é¡¾å®¢éå¸¸æ»¡æ„ï¼Œå½“åœºè¡¨ç¤º"ä½ ä»¬è¿™ä¸ªå°å§‘å¨˜çœŸä¸“ä¸šï¼Œæ¯”åŒ»é™¢çš„éƒ½è®²å¾—æ¸…æ¥š"ã€‚',
                riskLevel: 'low',
                transcript: [
                    { role: 'user', text: 'å¸®æˆ‘ä¹°ç›’é™å‹è¯ã€‚', time: '10:45:05' },
                    { role: 'staff', text: 'å¥½çš„ï¼Œè€äººå®¶æœ‰æ²¡æœ‰ç³–å°¿ç—…æˆ–è€…è‚¾è„æ–¹é¢çš„é—®é¢˜å‘¢ï¼Ÿ', time: '10:45:12', highlight: true, note: 'ä¸»åŠ¨è¯¢é—®ç—…å²' },
                    { role: 'user', text: 'æ²¡æœ‰ï¼Œå°±æ˜¯è¡€å‹æœ‰ç‚¹é«˜ã€‚', time: '10:45:20' },
                    { role: 'staff', text: 'é‚£è¿™ä¸ªå¯ä»¥ã€‚æ¯å¤©æ—©ä¸Šä¸€ç‰‡ï¼Œç©ºè…¹åƒæ•ˆæœæœ€å¥½ã€‚å¦å¤–æé†’ä¸€ä¸‹ï¼Œåƒè¿™ä¸ªè¯æœŸé—´ä¸è¦åƒè¥¿æŸšï¼Œä¼šå½±å“è¯æ•ˆã€‚', time: '10:45:28', highlight: true, note: 'è´´å¿ƒæé†’' },
                    { role: 'user', text: 'ä½ ä»¬è¿™ä¸ªå°å§‘å¨˜çœŸä¸“ä¸šï¼Œè°¢è°¢å•Šï¼', time: '10:45:40' }
                ],
                actionSuggest: 'å»ºè®®å°†ç‹èŠ³çš„æœåŠ¡æ¡ˆä¾‹ä½œä¸ºåŸ¹è®­ç´ æï¼Œåœ¨å…¨å…¬å¸æ¨å¹¿ã€‚å¯ç»™äºˆæœˆåº¦"é‡‘ç‰Œåº—å‘˜"ç§°å·æˆ–ç‰©è´¨å¥–åŠ±ã€‚',
                trainingSuggest: 'æå–ç‹èŠ³çš„æœåŠ¡è¯æœ¯ï¼Œåˆ¶ä½œæˆ"è€å¹´äººç”¨è¯æœåŠ¡æ ‡å‡†æµç¨‹"ï¼Œä¾›å…¶ä»–å‘˜å·¥å­¦ä¹ ã€‚'
            },
            {
                id: 's4',
                type: 'anomaly',
                typeText: 'å¼‚å¸¸',
                priority: 'medium',
                priorityIcon: 'â—',
                title: 'åŒä¸€é¡¾å®¢çŸ­æ—¶é—´å†…è´­ä¹°å¤§é‡é•‡å’³è¯',
                time: '2026-01-13 15:10',
                store: 'å¤§å­¦åŸåº—',
                staff: {
                    name: 'åˆ˜æ´‹',
                    avatar: 'https://i.pravatar.cc/150?u=staff4'
                },
                summary: 'åŒä¸€é¡¾å®¢åœ¨30åˆ†é’Ÿå†…åˆ†ä¸¤æ¬¡è´­ä¹°å«å¯å¾…å› æˆåˆ†çš„é•‡å’³è¯æ°´å…±10ç“¶ï¼Œå•æ¬¡è´­ä¹°é‡å‡æ¥è¿‘é™è´­ä¸Šé™ã€‚åº—å‘˜åˆ˜æ´‹è™½ç„¶è¿›è¡Œäº†ç™»è®°ï¼Œä½†æœªè¯¢é—®è´­ä¹°åŸå› ã€‚æ­¤ç±»è¡Œä¸ºå¯èƒ½æ¶‰åŠè¯å“æ»¥ç”¨é£é™©ï¼Œéœ€å¼•èµ·é‡è§†ã€‚',
                riskLevel: 'medium',
                transcript: [
                    { role: 'user', text: 'æ¥5ç“¶æ­¢å’³æ°´ã€‚', time: '15:10:05' },
                    { role: 'staff', text: 'éœ€è¦ç™»è®°èº«ä»½è¯ã€‚', time: '15:10:10' },
                    { role: 'user', text: 'çŸ¥é“çŸ¥é“ã€‚', time: '15:10:15' },
                    { role: 'staff', text: 'å¥½äº†ï¼Œä¸€å…±95å—ã€‚', time: '15:10:25', highlight: true, note: 'æœªè¯¢é—®ç”¨é€”' }
                ],
                actionSuggest: 'å»ºè®®ç«‹å³è°ƒå–è¯¥é¡¾å®¢çš„è´­ä¹°è®°å½•ï¼Œæ ¸å®è´­ä¹°é¢‘æ¬¡ã€‚å¦‚å‘ç°å¼‚å¸¸ï¼Œéœ€å‘å½“åœ°è¯ç›‘éƒ¨é—¨æŠ¥å‘Šï¼Œå¹¶å°†è¯¥é¡¾å®¢åˆ—å…¥é‡ç‚¹å…³æ³¨åå•ã€‚',
                trainingSuggest: 'å¯¹å…¨å‘˜è¿›è¡Œ"ç‰¹æ®Šè¯å“é”€å”®ç®¡ç†"åŸ¹è®­ï¼Œæ˜ç¡®éº»é†‰è¯å“ã€ç²¾ç¥è¯å“çš„é”€å”®çº¢çº¿ã€‚é‡åˆ°å¤§é‡è´­ä¹°æˆ–é¢‘ç¹è´­ä¹°æƒ…å†µï¼Œå¿…é¡»å‘åº—é•¿æ±‡æŠ¥ã€‚'
            }
        ];

        const casesData = [
            { 
                id: 'c1', 
                name: 'ææ™“çº¢', 
                store: 'ä¸­å¿ƒå¹¿åœºåº—', 
                tag: 'æ•™ç§‘ä¹¦å¼æŒ½ç•™', 
                reason: 'åœ¨é¡¾å®¢æ˜ç¡®è¡¨ç¤ºâ€œå«Œè´µâ€æ‹’ç»åï¼Œåº—å‘˜æ²¡æœ‰é™ä»·ï¼Œè€Œæ˜¯å·§å¦™ä½¿ç”¨äº†â€œå¹³æ‘Šæˆæœ¬æ³•â€ï¼ˆä¸€å¤©æ‰å‡ æ¯›é’±ï¼‰ï¼ŒæˆåŠŸæ‰“æ¶ˆé¡¾å®¢é¡¾è™‘ï¼Œå®Œæˆé«˜å®¢å•ä»·è½¬åŒ–ã€‚',
                duration: '5åˆ†12ç§’',
                startTime: 'ä»Šæ—¥ 10:30',
                transcript: [
                    { role: 'staff', text: 'å§ï¼Œè¿™æ¬¾èƒ¶åŸè›‹ç™½è‚½ç°åœ¨æ´»åŠ¨å¾ˆåˆ’ç®—ï¼Œä¹°ä¸‰é€ä¸€ã€‚', time: '10:30:15' },
                    { role: 'user', text: 'å“å“Ÿï¼Œå¤ªè´µäº†ï¼Œä¸‰ç™¾å¤šå—é’±å‘¢ï¼Œä¸ä¹°äº†ã€‚', time: '10:30:22' },
                    { role: 'staff', text: 'å§ï¼Œä¹ä¸€å¬æ˜¯æŒºè´µã€‚ä½†æ‚¨ç®—ç¬”è´¦ï¼Œä¸€å¥—èƒ½åƒä¸¤ä¸ªæœˆã€‚', highlight: true, note: 'æ‹†è§£æˆæœ¬', time: '10:30:28' },
                    { role: 'staff', text: 'å¹³æ‘Šä¸‹æ¥æ¯å¤©ä¸åˆ°5å—é’±ï¼Œä¹Ÿå°±ä¸€æ¯å¥¶èŒ¶é’±ã€‚å¥¶èŒ¶å–äº†é•¿èƒ–ï¼Œè¿™ä¸ªå–äº†èƒ½è®©çš®è‚¤å˜äº®ï¼Œå¤šå€¼å‘€ï¼', highlight: true, note: 'ä»·å€¼é”šå®š', time: '10:30:45' },
                    { role: 'user', text: 'å‘µå‘µï¼Œä½ è¿™å°å§‘å¨˜çœŸä¼šè¯´è¯ã€‚é‚£è¡Œå§ï¼Œæ¥ä¸€å¥—ã€‚', time: '10:31:05' }
                ]
            },
            { 
                id: 'c2', 
                name: 'ç‹å¼º', 
                store: 'æ»¨æ±Ÿè·¯åˆ†åº—', 
                tag: 'é«˜æƒ…å•†å›å¤', 
                reason: 'é¢å¯¹é¡¾å®¢å¯¹è¯æ•ˆçš„è´¨ç–‘ï¼Œæ²¡æœ‰ç›´æ¥åé©³ï¼Œè€Œæ˜¯é€šè¿‡â€œå…±æƒ…+ä¸“ä¸šèƒŒä¹¦â€çš„æ–¹å¼å»ºç«‹ä¿¡ä»»ï¼Œä½“ç°äº†æé«˜çš„æœåŠ¡æ°´å‡†ã€‚',
                duration: '3åˆ†45ç§’',
                startTime: 'ä»Šæ—¥ 14:15',
                transcript: [
                    { role: 'user', text: 'ä½ ä»¬è¿™è¯æ˜¯ä¸æ˜¯å‡çš„å•Šï¼Ÿåƒäº†ä¸¤å¤©æ²¡ä¸€ç‚¹ç”¨ã€‚', time: '14:15:10' },
                    { role: 'staff', text: 'å¤§å“¥æ‚¨åˆ«æ€¥ï¼Œæˆ‘ç‰¹åˆ«ç†è§£æ‚¨çš„å¿ƒæƒ…ï¼Œç”Ÿç—…äº†è°éƒ½æƒ³é©¬ä¸Šå¥½ã€‚', highlight: true, note: 'å…ˆå…±æƒ…', time: '14:15:18' },
                    { role: 'staff', text: 'ä¸è¿‡ä¸­æˆè¯èµ·æ•ˆç¡®å®æ¸©å’Œäº›ã€‚æ‚¨çœ‹è¯´æ˜ä¹¦è¿™é‡Œå†™äº†ï¼Œé€šå¸¸ä¸‰å¤©åç—‡çŠ¶ä¼šæ˜æ˜¾ç¼“è§£ã€‚å¦‚æœæ˜å¤©è¿˜ä¸è§å¥½ï¼Œæ‚¨å¯ä»¥æ¥æ‰¾æˆ‘ï¼Œæˆ‘å¸®æ‚¨è”ç³»åŒ»ç”Ÿã€‚', highlight: true, note: 'å†è®²ç†', time: '14:15:35' },
                    { role: 'user', text: 'è¡Œå§ï¼Œé‚£æˆ‘å†åƒä¸¤å¤©çœ‹çœ‹ã€‚', time: '14:15:50' }
                ]
            }
        ];

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            renderMetrics();
            renderSupervisionTasks();
            renderHotWords();
            renderSentiments();
            renderCases();
        });

        // --- Render Functions ---
        function renderMetrics() {
            const container = document.getElementById('metrics-scroll-container');
            container.innerHTML = metricsData.map((m, idx) => `
                <div onclick="openMetricDetailView(${idx})" class="inline-block w-40 glass-panel p-3 rounded-xl border border-white/5 active:scale-95 transition-transform cursor-pointer">
                    <div class="text-[10px] text-slate-400 mb-1">${m.title}</div>
                    <div class="text-xl font-bold text-white mb-2 font-mono">${m.value}</div>
                    <div class="flex items-center text-[10px] ${m.isUp ? 'text-neon-green' : 'text-neon-red'}">
                        <i class="fa-solid fa-arrow-trend-${m.isUp ? 'up' : 'down'} mr-1"></i>
                        <span>${m.changeAbs}</span>
                        <span class="ml-1 opacity-70">(${m.changeRel})</span>
                    </div>
                </div>
            `).join('');
            // Padding right hint
            container.insertAdjacentHTML('beforeend', '<div class="inline-block w-2"></div>');
        }

        function renderSupervisionTasks() {
            const container = document.getElementById('supervision-task-list');
            container.innerHTML = supervisionTasks.map(t => `
                <div class="glass-panel p-3 rounded-lg border border-white/5 relative group cursor-pointer active:scale-95 transition-transform" onclick="openTaskDetailView(${t.id})">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1">
                            <h3 class="text-sm font-bold text-white mb-1">${t.title}</h3>
                            <div class="flex items-center space-x-2">
                                <span class="text-[10px] text-slate-500"><i class="fa-regular fa-clock mr-1"></i>${t.createTime}</span>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button class="text-slate-500 hover:text-neon-blue" onclick="event.stopPropagation(); openTaskShareModal(${t.id})">
                                <i class="fa-solid fa-share-nodes text-xs"></i>
                            </button>
                            <button class="text-slate-500 hover:text-neon-blue" onclick="event.stopPropagation(); openEditTaskView(event, ${t.id})">
                                <i class="fa-solid fa-pen text-xs"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-end justify-between">
                        <div>
                            <div class="text-[10px] text-slate-500 mb-0.5">æ˜¨æ—¥æ‰§è¡Œç‡</div>
                            <div class="text-lg font-bold text-white font-mono">${t.value}</div>
                        </div>
                        <div class="text-[10px] ${t.isUp ? 'text-neon-green' : 'text-neon-red'}">
                            ${t.changeRel}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderHotWords() {
            const container = document.getElementById('insights-keywords');
            container.innerHTML = hotWords.map((w, idx) => {
                return `
                <div class="glass-panel rounded-lg overflow-hidden border border-white/5">
                    <!-- Head -->
                    <div class="flex items-center justify-between p-3">
                        <div class="flex items-center space-x-3">
                            <span class="font-mono text-sm font-bold w-4 text-center ${idx < 3 ? 'text-neon-blue' : 'text-slate-500'}">${w.rank}</span>
                            <div>
                                <div class="text-sm text-white font-medium flex items-center">
                                    ${w.text}
                                    <span class="ml-2 text-[10px] bg-slate-700 text-slate-300 px-1.5 rounded">${w.type}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-xs text-white font-bold font-mono">${w.count}</div>
                    </div>
                </div>
            `}).join('');
        }

        function renderSentiments(filterType = 'all') {
            const container = document.getElementById('sentiment-cards-container');
            
            // Filter data based on selected type
            const filteredData = filterType === 'all' ? sentimentData : sentimentData.filter(s => s.type === filterType);
            
            container.innerHTML = filteredData.map(s => {
                // Type color mapping (only for labels)
                let typeColorClass = '';
                switch(s.type) {
                    case 'complaint':
                        typeColorClass = 'text-neon-red bg-neon-red/20 border-neon-red/30';
                        break;
                    case 'risk':
                        typeColorClass = 'text-orange-400 bg-orange-400/20 border-orange-400/30';
                        break;
                    case 'praise':
                        typeColorClass = 'text-neon-green bg-neon-green/20 border-neon-green/30';
                        break;
                    case 'anomaly':
                        typeColorClass = 'text-yellow-400 bg-yellow-400/20 border-yellow-400/30';
                        break;
                }

                return `
                <div onclick="openSentimentDetailView('${s.id}')" class="glass-panel rounded-xl p-4 border border-white/5 relative cursor-pointer active:scale-95 transition-transform">
                    <!-- Type & Priority -->
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <span class="text-xs font-bold px-2.5 py-1 rounded-full border ${typeColorClass}">${s.typeText}</span>
                        </div>
                        <span class="text-[10px] text-slate-500">${s.time.split(' ')[1]}</span>
                    </div>

                    <!-- Title -->
                    <h3 class="text-sm font-bold text-white mb-2">${s.title}</h3>

                    <!-- Summary -->
                    <p class="text-xs text-slate-300 leading-relaxed mb-3 line-clamp-2">${s.summary}</p>

                    <!-- Meta Info -->
                    <div class="flex items-center justify-between pt-2 border-t border-white/5">
                        <div class="flex items-center space-x-3 text-[10px] text-slate-400">
                            <span><i class="fa-solid fa-store mr-1"></i>${s.store}</span>
                            <span><i class="fa-solid fa-user mr-1"></i>${s.staff.name}</span>
                        </div>
                        <i class="fa-solid fa-chevron-right text-xs text-slate-500"></i>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderCases() {
            const container = document.getElementById('cases-list');
            container.innerHTML = casesData.map(c => `
                <div onclick="openCaseDetailView('${c.id}')" class="glass-panel rounded-xl p-4 border border-white/5 relative group cursor-pointer active:scale-95 transition-transform">
                    <div class="flex justify-between items-start mb-3">
                         <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-slate-700 overflow-hidden border border-white/10">
                                <img src="https://i.pravatar.cc/150?u=${c.id}" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <div class="text-sm font-bold text-white">${c.name}</div>
                                <div class="text-[10px] text-slate-400">${c.store}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white/5 rounded-lg p-3 mb-3 border-l-2 border-neon-blue">
                        <div class="flex items-center space-x-2 mb-1">
                             <span class="text-[10px] bg-neon-blue/20 text-neon-blue px-1.5 py-0.5 rounded font-bold">${c.tag}</span>
                             <span class="text-[10px] text-slate-400">å…¥é€‰ç†ç”±</span>
                        </div>
                        <div class="text-xs text-slate-200 leading-relaxed font-medium line-clamp-2">
                            ${c.reason}
                        </div>
                    </div>

                    <div class="flex justify-between items-center pt-2 border-t border-white/5">
                        <div class="text-[10px] text-slate-500">
                            ä¼šè¯æ—¶é—´ <span class="text-white font-mono ml-1">${c.startTime}</span>
                        </div>
                         <div class="text-[10px] text-slate-500">
                            æ—¶é•¿ <span class="text-white font-mono ml-1">${c.duration}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // --- Sentiment Filter Logic ---
        function filterSentiments(type) {
            // Update active button state
            const filterButtons = {
                'all': 'filter-all',
                'complaint': 'filter-complaint',
                'risk': 'filter-risk',
                'praise': 'filter-praise',
                'anomaly': 'filter-anomaly'
            };
            
            // Color mapping for active states
            const activeColors = {
                'all': { bg: 'bg-neon-blue/20', text: 'text-neon-blue', border: 'border-neon-blue/30' },
                'complaint': { bg: 'bg-neon-red/20', text: 'text-neon-red', border: 'border-neon-red/30' },
                'risk': { bg: 'bg-orange-400/20', text: 'text-orange-400', border: 'border-orange-400/30' },
                'praise': { bg: 'bg-neon-green/20', text: 'text-neon-green', border: 'border-neon-green/30' },
                'anomaly': { bg: 'bg-yellow-400/20', text: 'text-yellow-400', border: 'border-yellow-400/30' }
            };

            // Reset all buttons to inactive state
            Object.values(filterButtons).forEach(btnId => {
                const btn = document.getElementById(btnId);
                btn.className = 'px-3 py-1.5 text-xs font-medium rounded-full bg-transparent text-slate-400 border border-white/10 transition-all';
            });

            // Set active button
            const activeBtn = document.getElementById(filterButtons[type]);
            const colors = activeColors[type];
            activeBtn.className = `px-3 py-1.5 text-xs font-medium rounded-full ${colors.bg} ${colors.text} border ${colors.border} transition-all`;

            // Re-render sentiments with filter
            renderSentiments(type);
        }

        // --- Insights Sub-Tab Logic ---
        function switchInsightsSubTab(tab) {
            // Update buttons
            const keywordsBtn = document.getElementById('tab-insights-keywords');
            const sentimentBtn = document.getElementById('tab-insights-sentiment');
            const keywordsPanel = document.getElementById('insights-keywords');
            const sentimentPanel = document.getElementById('insights-sentiment');

            if (tab === 'keywords') {
                keywordsBtn.classList.add('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                keywordsBtn.classList.remove('text-slate-400', 'bg-transparent');
                sentimentBtn.classList.remove('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                sentimentBtn.classList.add('text-slate-400', 'bg-transparent');
                keywordsPanel.classList.remove('hidden');
                sentimentPanel.classList.add('hidden');
            } else {
                sentimentBtn.classList.add('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                sentimentBtn.classList.remove('text-slate-400', 'bg-transparent');
                keywordsBtn.classList.remove('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                keywordsBtn.classList.add('text-slate-400', 'bg-transparent');
                sentimentPanel.classList.remove('hidden');
                keywordsPanel.classList.add('hidden');
            }
        }

        // --- Sentiment Detail Logic ---
        let currentSentimentId = null;

        function openSentimentDetailView(sentimentId) {
            const s = sentimentData.find(x => x.id === sentimentId);
            if (!s) return;
            currentSentimentId = sentimentId;

            // Type color mapping
            let typeColorClass = '';
            switch(s.type) {
                case 'complaint':
                    typeColorClass = 'bg-neon-red/20 text-neon-red border-neon-red/30';
                    break;
                case 'risk':
                    typeColorClass = 'bg-orange-400/20 text-orange-400 border-orange-400/30';
                    break;
                case 'praise':
                    typeColorClass = 'bg-neon-green/20 text-neon-green border-neon-green/30';
                    break;
                case 'anomaly':
                    typeColorClass = 'bg-yellow-400/20 text-yellow-400 border-yellow-400/30';
                    break;
            }

            // Populate Data
            document.getElementById('sentiment-type-tag').className = `text-xs font-bold px-3 py-1 rounded-full border ${typeColorClass}`;
            document.getElementById('sentiment-type-tag').innerText = s.typeText;
            document.getElementById('sentiment-priority').innerText = s.priority === 'high' ? s.priorityIcon : '';
            document.getElementById('sentiment-title').innerText = s.title;
            document.getElementById('sentiment-time').innerText = s.time;
            document.getElementById('sentiment-store').innerText = s.store;
            document.getElementById('sentiment-staff-avatar').src = s.staff.avatar;
            document.getElementById('sentiment-staff-name').innerText = s.staff.name;
            document.getElementById('sentiment-summary').innerText = s.summary;

            // Transcript
            const transcriptContainer = document.getElementById('sentiment-transcript');
            transcriptContainer.innerHTML = s.transcript.map(msg => {
                const isStaff = msg.role === 'staff';
                const alignClass = isStaff ? 'justify-end' : 'justify-start';
                const bubbleClass = isStaff ? 'bg-slate-800/50 text-slate-200 rounded-tr-none border border-white/5' : 'bg-white/5 text-slate-300 rounded-tl-none border border-white/5';

                return `
                    <div class="flex ${alignClass}">
                        <div class="max-w-[80%] p-3 rounded-2xl text-xs leading-relaxed ${bubbleClass}">
                            <div class="text-[9px] text-slate-500 mb-1">${isStaff ? 'åº—å‘˜' : 'é¡¾å®¢'} ${msg.time}</div>
                            ${msg.text}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('sentiment-detail-view').classList.remove('translate-x-full');
        }

        function hideSentimentDetailView() {
            document.getElementById('sentiment-detail-view').classList.add('translate-x-full');
        }

        // --- Sentiment Share Modal Logic ---
        function openSentimentShareModal() {
            const s = sentimentData.find(x => x.id === currentSentimentId);
            if (!s) return;

            // Type color mapping
            let typeColorClass = '';
            switch(s.type) {
                case 'complaint':
                    typeColorClass = 'bg-neon-red/20 text-neon-red border-neon-red/30 border';
                    break;
                case 'risk':
                    typeColorClass = 'bg-orange-400/20 text-orange-400 border-orange-400/30 border';
                    break;
                case 'praise':
                    typeColorClass = 'bg-neon-green/20 text-neon-green border-neon-green/30 border';
                    break;
                case 'anomaly':
                    typeColorClass = 'bg-yellow-400/20 text-yellow-400 border-yellow-400/30 border';
                    break;
            }

            document.getElementById('poster-sentiment-type').className = `inline-block px-3 py-1 rounded-full text-xs font-bold ${typeColorClass}`;
            document.getElementById('poster-sentiment-type').innerText = s.typeText;
            document.getElementById('poster-sentiment-priority').innerText = s.priority === 'high' ? s.priorityIcon : '';
            document.getElementById('poster-sentiment-time').innerText = s.time;
            document.getElementById('poster-sentiment-title').innerText = s.title;
            document.getElementById('poster-sentiment-avatar').src = s.staff.avatar;
            document.getElementById('poster-sentiment-staff').innerText = s.staff.name;
            document.getElementById('poster-sentiment-store').innerText = s.store;
            document.getElementById('poster-sentiment-summary').innerText = s.summary;

            // Select key transcript (first 3 messages)
            const keyTranscript = s.transcript.slice(0, 3);
            const transcriptContainer = document.getElementById('poster-sentiment-transcript');
            transcriptContainer.innerHTML = keyTranscript.map(t => `
                <div class="flex items-start space-x-2">
                    <div class="font-bold text-slate-500 flex-shrink-0">${t.role === 'staff' ? 'åº—å‘˜' : 'é¡¾å®¢'}:</div>
                    <div>${t.text}</div>
                </div>
            `).join('');

            document.getElementById('share-sentiment-modal').classList.remove('hidden');
        }

        function closeSentimentShareModal() {
            document.getElementById('share-sentiment-modal').classList.add('hidden');
        }

        // --- Case Detail Logic ---
        let currentCaseId = null;

        function openCaseDetailView(caseId) {
             const c = casesData.find(x => x.id === caseId);
             if (!c) return;
             currentCaseId = caseId;

             // Populate Data
             document.getElementById('case-detail-name').innerText = c.name;
             document.getElementById('case-detail-store').innerText = c.store;
             document.getElementById('case-detail-avatar').src = `https://i.pravatar.cc/150?u=${c.id}`;
             document.getElementById('case-detail-tag').innerText = '#' + c.tag;
             document.getElementById('case-detail-reason').innerText = c.reason;

             // Transcript
             const list = document.getElementById('case-transcript-list');
             list.innerHTML = c.transcript.map(msg => {
                 const isStaff = msg.role === 'staff';
                 const alignClass = isStaff ? 'justify-end' : 'justify-start';
                 const bubbleClass = isStaff ? 'bg-neon-blue/10 text-white rounded-tr-none border border-neon-blue/20' : 'bg-slate-800 text-slate-300 rounded-tl-none border border-white/5';

                 return `
                    <div class="flex flex-col ${isStaff ? 'items-end' : 'items-start'} mb-4">
                        <div class="flex ${alignClass} mb-1">
                            ${!isStaff ? '<div class="w-6 h-6 rounded-full bg-slate-600 flex-shrink-0 mr-2 flex items-center justify-center text-[10px]"><i class="fa-solid fa-user"></i></div>' : ''}
                            <div class="max-w-[80%] p-3 rounded-2xl text-xs leading-relaxed ${bubbleClass}">
                                ${msg.text}
                            </div>
                            ${isStaff ? `<div class="w-6 h-6 rounded-full bg-slate-700 flex-shrink-0 ml-2 overflow-hidden"><img src="https://i.pravatar.cc/150?u=${c.id}" class="w-full h-full"></div>` : ''}
                        </div>
                        <div class="text-[9px] text-slate-600 px-10 font-mono">${msg.time}</div>
                    </div>
                 `;
             }).join('');

             document.getElementById('case-detail-view').classList.remove('translate-x-full');
        }

        function hideCaseDetailView() {
            document.getElementById('case-detail-view').classList.add('translate-x-full');
        }

        // --- Interaction Logic ---
        function switchHomeTab(tab) {
            // Update Headers
            ['supervision', 'insights', 'cases'].forEach(t => {
                const btn = document.getElementById(`tab-home-${t}`);
                const panel = document.getElementById(`panel-home-${t}`);
                if (t === tab) {
                    btn.classList.add('text-neon-blue', 'border-neon-blue');
                    btn.classList.remove('text-slate-400', 'border-transparent');
                    panel.classList.remove('hidden');
                } else {
                    btn.classList.remove('text-neon-blue', 'border-neon-blue');
                    btn.classList.add('text-slate-400', 'border-transparent');
                    panel.classList.add('hidden');
                }
            });
        }


        // --- Metric Detail Logic ---
        let metricDetailChart = null;
        let currentMetricIndex = null;
        let currentTrendType = '7days'; // '7days' or 'hourly'

        // Mock 7-day trend data for each metric
        const metricTrendData = {
            0: { // å®¢æµé‡
                labels: ['01-07', '01-08', '01-09', '01-10', '01-11', '01-12', '01-13'],
                data: [1180, 1210, 1195, 1230, 1220, 1200, 1250],
                unit: 'äºº'
            },
            1: { // å·¥ç‰Œä½¿ç”¨ç‡
                labels: ['01-07', '01-08', '01-09', '01-10', '01-11', '01-12', '01-13'],
                data: [78, 80, 82, 80, 83, 80, 85],
                unit: '%'
            },
            2: { // å¹³å‡ä½¿ç”¨æ—¶é•¿
                labels: ['01-07', '01-08', '01-09', '01-10', '01-11', '01-12', '01-13'],
                data: [7.5, 7.6, 7.8, 7.4, 7.5, 7.7, 7.2],
                unit: 'h'
            }
        };

        // Mock hourly trend data for yesterday (every 3 hours)
        const metricHourlyData = {
            0: { // å®¢æµé‡
                labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                data: [12, 8, 15, 125, 180, 210, 165, 85],
                unit: 'äºº'
            },
            1: { // å·¥ç‰Œä½¿ç”¨ç‡
                labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                data: [0, 0, 15, 85, 95, 92, 88, 45],
                unit: '%'
            },
            2: { // å¹³å‡ä½¿ç”¨æ—¶é•¿
                labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
                data: [0, 0, 0.5, 3.5, 5.2, 6.8, 7.2, 4.5],
                unit: 'h'
            }
        };

        // Mock store ranking data for each metric
        const metricStoreData = {
            0: [ // å®¢æµé‡
                { name: 'ä¸­å¿ƒå¹¿åœºåº—', value: '298äºº' },
                { name: 'æ»¨æ±Ÿè·¯åˆ†åº—', value: '265äºº' },
                { name: 'ä½“è‚²é¦†åº—', value: '242äºº' },
                { name: 'å¤§å­¦åŸåº—', value: '210äºº' },
                { name: 'è€åŸåŒºåº—', value: '188äºº' },
                { name: 'é«˜æ–°åŒºåº—', value: '47äºº' }
            ],
            1: [ // å·¥ç‰Œä½¿ç”¨ç‡
                { name: 'ä½“è‚²é¦†åº—', value: '96%' },
                { name: 'ä¸­å¿ƒå¹¿åœºåº—', value: '92%' },
                { name: 'æ»¨æ±Ÿè·¯åˆ†åº—', value: '88%' },
                { name: 'é«˜æ–°åŒºåº—', value: '76%' },
                { name: 'å¤§å­¦åŸåº—', value: '65%' },
                { name: 'è€åŸåŒºåº—', value: '58%' }
            ],
            2: [ // å¹³å‡ä½¿ç”¨æ—¶é•¿
                { name: 'ä¸­å¿ƒå¹¿åœºåº—', value: '8.5h' },
                { name: 'æ»¨æ±Ÿè·¯åˆ†åº—', value: '8.2h' },
                { name: 'ä½“è‚²é¦†åº—', value: '7.6h' },
                { name: 'é«˜æ–°åŒºåº—', value: '7.1h' },
                { name: 'å¤§å­¦åŸåº—', value: '6.5h' },
                { name: 'è€åŸåŒºåº—', value: '5.8h' }
            ]
        };

        function openMetricDetailView(metricIndex) {
            const metric = metricsData[metricIndex];
            if (!metric) return;
            
            currentMetricIndex = metricIndex;
            currentTrendType = '7days'; // Reset to default

            // Fill Basic Info
            document.getElementById('metric-detail-title').innerText = metric.title;
            document.getElementById('metric-detail-value').innerText = metric.value;
            
            // Fill Change Info
            const changeEl = document.getElementById('metric-detail-change');
            const colorClass = metric.isUp ? 'text-neon-green' : 'text-neon-red';
            const iconClass = metric.isUp ? 'up' : 'down';
            changeEl.className = `flex items-center justify-center text-sm ${colorClass}`;
            changeEl.innerHTML = `
                <i class="fa-solid fa-arrow-trend-${iconClass} mr-2"></i>
                <span>${metric.changeAbs}</span>
                <span class="ml-2 opacity-70">(${metric.changeRel})</span>
            `;

            // Show warning for Traffic metric
            const warningEl = document.getElementById('metric-warning');
            if (metricIndex === 0) { // å®¢æµé‡
                warningEl.classList.remove('hidden');
            } else {
                warningEl.classList.add('hidden');
            }

            // Show/Hide trend switch buttons (Only for Traffic - index 0)
            const trendSwitchContainer = document.getElementById('trend-switch-container');
            const chartTitleEl = document.getElementById('metric-chart-title');
            
            if (metricIndex === 0) { // å®¢æµé‡ - Show switch buttons
                trendSwitchContainer.classList.remove('hidden');
                trendSwitchContainer.classList.add('flex');
                chartTitleEl.innerText = 'è¶‹åŠ¿åˆ†æ';
                
                // Reset trend buttons to default (7days)
                const btn7days = document.getElementById('btn-trend-7days');
                const btnHourly = document.getElementById('btn-trend-hourly');
                btn7days.classList.add('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                btn7days.classList.remove('text-slate-400', 'bg-transparent');
                btnHourly.classList.remove('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                btnHourly.classList.add('text-slate-400', 'bg-transparent');
            } else { // å…¶ä»–æŒ‡æ ‡ - Hide switch buttons, show simple title
                trendSwitchContainer.classList.add('hidden');
                trendSwitchContainer.classList.remove('flex');
                chartTitleEl.innerText = 'è¿‘7æ—¥è¶‹åŠ¿';
            }

            // Render Chart with default trend type
            renderMetricChart(metricIndex, currentTrendType);

            // Render Store List
            renderMetricStoreList(metricIndex);

            document.getElementById('metric-detail-view').classList.remove('translate-x-full');
        }

        function hideMetricDetailView() {
            document.getElementById('metric-detail-view').classList.add('translate-x-full');
        }

        function switchMetricTrend(trendType) {
            // Only allow switch for Traffic metric (index 0)
            if (currentMetricIndex !== 0) return;
            
            // Update button states
            const btn7days = document.getElementById('btn-trend-7days');
            const btnHourly = document.getElementById('btn-trend-hourly');
            
            if (trendType === '7days') {
                btn7days.classList.add('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                btn7days.classList.remove('text-slate-400', 'bg-transparent');
                btnHourly.classList.remove('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                btnHourly.classList.add('text-slate-400', 'bg-transparent');
            } else {
                btnHourly.classList.add('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                btnHourly.classList.remove('text-slate-400', 'bg-transparent');
                btn7days.classList.remove('text-white', 'bg-neon-blue/20', 'border', 'border-neon-blue/30');
                btn7days.classList.add('text-slate-400', 'bg-transparent');
            }
            
            // Update current trend type and re-render chart
            currentTrendType = trendType;
            renderMetricChart(currentMetricIndex, currentTrendType);
        }

        function renderMetricChart(metricIndex, trendType = '7days') {
            const ctx = document.getElementById('metric-detail-chart').getContext('2d');
            if (metricDetailChart) metricDetailChart.destroy();

            // Select data source based on trend type
            const trendData = trendType === '7days' ? metricTrendData[metricIndex] : metricHourlyData[metricIndex];
            if (!trendData) return;

            metricDetailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: trendData.labels,
                    datasets: [{
                        label: metricsData[metricIndex].title,
                        data: trendData.data,
                        borderColor: '#00F0FF',
                        backgroundColor: 'rgba(0, 240, 255, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#00F0FF',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { 
                                color: '#94a3b8', 
                                font: { size: 10 },
                                callback: function(value) {
                                    return value + trendData.unit;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderMetricStoreList(metricIndex) {
            const list = document.getElementById('metric-store-list');
            const stores = metricStoreData[metricIndex];
            if (!stores) return;

            list.innerHTML = stores.map((s, idx) => {
                let colorClass = 'text-slate-200';
                if (idx < 3) {
                    colorClass = 'text-neon-green'; // Top 3
                } else if (idx >= stores.length - 2) {
                    colorClass = 'text-neon-red'; // Bottom 2
                } else {
                    colorClass = 'text-neon-blue'; // Others
                }
                
                return `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/5">
                        <div class="flex items-center space-x-3">
                            <span class="text-xs text-slate-500 w-4 font-mono">${idx + 1}</span>
                            <span class="text-sm text-slate-200">${s.name}</span>
                        </div>
                        <span class="text-sm font-bold font-mono ${colorClass}">${s.value}</span>
                    </div>
                `;
            }).join('');
        }

        // --- View Transitions ---
        function openCreateTaskView() {
            // Reset to Create Mode
            document.getElementById('create-task-title').innerText = 'æ–°å»ºä»»åŠ¡';
            document.getElementById('ai-input-section').classList.remove('hidden');
            document.getElementById('generated-result-area').classList.add('hidden');
            document.getElementById('btn-initial-generate').classList.remove('hidden');
            document.getElementById('btn-group-generated').classList.add('hidden');
            document.getElementById('btn-group-generated').classList.remove('flex');
            
            // Clear inputs
            document.getElementById('ai-input-desc').value = '';
            document.getElementById('task-name').value = '';
            document.getElementById('task-intro').value = '';
            document.getElementById('task-action').value = '';

            document.getElementById('create-task-view').classList.remove('translate-x-full');
        }

        function openEditTaskView(event, taskId) {
            event.stopPropagation(); // Prevent card click
            const task = supervisionTasks.find(t => t.id === taskId);
            if (!task) return;

            // Set to Edit Mode
            document.getElementById('create-task-title').innerText = 'ç¼–è¾‘ä»»åŠ¡';
            document.getElementById('ai-input-section').classList.add('hidden');
            document.getElementById('generated-result-area').classList.remove('hidden');
            document.getElementById('btn-initial-generate').classList.add('hidden');
            document.getElementById('btn-group-generated').classList.remove('hidden');
            document.getElementById('btn-group-generated').classList.add('flex');
            
            document.getElementById('btn-save-task').innerHTML = '<i class="fa-solid fa-check mr-1"></i> ä¿å­˜ä¿®æ”¹';

            // Fill Data
            document.getElementById('task-name').value = task.title;
            document.getElementById('task-intro').value = task.desc + " (æ­¤å¤„ä¸ºè¯¦ç»†æè¿°...)";
            document.getElementById('task-action').value = "è¯æœ¯å»ºè®®ï¼šè¯·æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ¨è...";

            // Update character counts
            updateCharCount('task-name', 20);
            updateCharCount('task-intro', 100);
            updateCharCount('task-action', 200);

            document.getElementById('create-task-view').classList.remove('translate-x-full');
        }

        function hideCreateTaskView() {
            document.getElementById('create-task-view').classList.add('translate-x-full');
        }

        // --- Task Detail View Logic ---
        let detailChart = null;
        let currentDetailTaskId = null;

        function openTaskDetailView(taskId) {
            const task = supervisionTasks.find(t => t.id === taskId);
            if (!task) return;
            
            currentDetailTaskId = taskId;

            // Fill Basic Info
            document.getElementById('detail-task-title').innerText = task.title;
            document.getElementById('detail-task-value').innerText = task.value;
            document.getElementById('detail-task-intro').innerText = task.desc + "ã€‚è¯¥æŒ‡æ ‡ç”¨äºæ£€æµ‹åº—å‘˜åœ¨æ¥å¾…è¿‡ç¨‹ä¸­æ˜¯å¦æŒ‰ç…§å…¬å¸è§„å®šæ‰§è¡Œäº†æ ‡å‡†åŠ¨ä½œã€‚";
            document.getElementById('detail-task-action').innerText = "1. è¯¢é—®é¡¾å®¢éœ€æ±‚ã€‚\n2. é’ˆå¯¹æ€§æ¨èç›¸å…³äº§å“ã€‚\n3. æé†’ç”¨æ³•ç”¨é‡ã€‚\n(è¯æœ¯ç¤ºä¾‹ï¼šæ­é…è¿™ä¸ªæ•ˆæœæ›´å¥½...)";

            // Render Chart
            renderDetailChart();

            // Render Store List
            renderStoreList();

            document.getElementById('task-detail-view').classList.remove('translate-x-full');
        }

        function hideTaskDetailView() {
            document.getElementById('task-detail-view').classList.add('translate-x-full');
        }

        function renderDetailChart() {
            const ctx = document.getElementById('detail-task-chart').getContext('2d');
            if (detailChart) detailChart.destroy();

            // Mock Data
            const labels = ['01-07', '01-08', '01-09', '01-10', '01-11', '01-12', '01-13'];
            const data = [65, 68, 62, 70, 72, 69, 75];

            detailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ‰§è¡Œç‡',
                        data: data,
                        borderColor: '#00F0FF',
                        backgroundColor: 'rgba(0, 240, 255, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#00F0FF',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8', font: { size: 10 } },
                            min: 50,
                            max: 100
                        }
                    }
                }
            });
        }

        function renderStoreList() {
            const list = document.getElementById('detail-store-list');
            // Mock Stores
            const stores = [
                { name: 'ä¸­å¿ƒå¹¿åœºåº—', rate: '92%', status: 'high' },
                { name: 'æ»¨æ±Ÿè·¯åˆ†åº—', rate: '88%', status: 'high' },
                { name: 'ä½“è‚²é¦†åº—', rate: '76%', status: 'mid' },
                { name: 'å¤§å­¦åŸåº—', rate: '65%', status: 'low' },
                { name: 'è€åŸåŒºåº—', rate: '58%', status: 'low' },
            ];

            list.innerHTML = stores.map((s, idx) => {
                let colorClass = s.status === 'high' ? 'text-neon-green' : (s.status === 'mid' ? 'text-neon-blue' : 'text-neon-red');
                return `
                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg border border-white/5">
                        <div class="flex items-center space-x-3">
                            <span class="text-xs text-slate-500 w-4 font-mono">${idx + 1}</span>
                            <span class="text-sm text-slate-200">${s.name}</span>
                        </div>
                        <span class="text-sm font-bold font-mono ${colorClass}">${s.rate}</span>
                    </div>
                `;
            }).join('');
        }

        // --- Character Count Update ---
        function updateCharCount(fieldId, maxLength) {
            const field = document.getElementById(fieldId);
            const countSpan = document.getElementById(fieldId + '-count');
            if (countSpan) {
                const currentLength = field.value.length;
                const colorClass = currentLength >= maxLength ? 'text-neon-red' : 'text-neon-blue';
                countSpan.innerHTML = `<span class="${colorClass}">${currentLength}</span>/${maxLength}`;
            }
        }

        // --- AI Interaction & Task Creation ---
        function fillInput(text) {
            document.getElementById('ai-input-desc').value = text;
        }

        function triggerGenerate() {
            const btn = document.getElementById('btn-initial-generate');
            const resultArea = document.getElementById('generated-result-area');
            const btnGroup = document.getElementById('btn-group-generated');
            const inputDesc = document.getElementById('ai-input-desc').value;

            // Loading
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> ç”Ÿæˆä¸­...';
            btn.disabled = true;

            setTimeout(() => {
                // Show results
                resultArea.classList.remove('hidden');
                
                // Switch Buttons
                btn.classList.add('hidden');
                btnGroup.classList.remove('hidden');
                btnGroup.classList.add('flex');

                // Fill Mock Data
                document.getElementById('task-name').value = "æµæ„Ÿå­£å…³è”ç»´Cæ¨å¹¿";
                document.getElementById('task-intro').value = "æ£€æµ‹åº—å‘˜åœ¨é”€å”®æ„Ÿå†’è¯ï¼ˆå¦‚æ„Ÿå†’çµã€å¸ƒæ´›èŠ¬ï¼‰æ—¶ï¼Œæ˜¯å¦ä¸»åŠ¨æ¨èäº†ç»´ç”Ÿç´ Cæˆ–æ³¡è…¾ç‰‡ã€‚";
                document.getElementById('task-action').value = "è¯æœ¯å»ºè®®ï¼šâ€œæ­é…ä¸€ç“¶ç»´ç”Ÿç´ Cï¼Œå¢å¼ºæŠµæŠ—åŠ›å¥½å¾—å¿«ã€‚â€";

                // Update character counts
                updateCharCount('task-name', 20);
                updateCharCount('task-intro', 100);
                updateCharCount('task-action', 200);

                // Scroll to bottom
                document.getElementById('create-task-body').scrollTo({ top: 1000, behavior: 'smooth' });
                
                // Reset Button State (in case we go back)
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 1000);
        }

        function regenerateField(fieldId) {
            const field = document.getElementById(fieldId);
            field.parentNode.classList.add('opacity-50');
            setTimeout(() => {
                field.parentNode.classList.remove('opacity-50');
                if(fieldId === 'task-name') {
                    field.value = "æ„Ÿå†’è¯å…³è”é”€å”®åˆè§„æ£€æŸ¥";
                    updateCharCount('task-name', 20);
                }
                if(fieldId === 'task-intro') {
                    field.value = "ç›‘æ§æ˜¯å¦åœ¨é¡¾å®¢è´­ä¹°æŠ—ç—…æ¯’è¯ç‰©æ—¶ï¼Œè¿›è¡Œäº†å…ç–«åŠ›äº§å“çš„å…³è”æ¨èã€‚";
                    updateCharCount('task-intro', 100);
                }
                if(fieldId === 'task-action') {
                    field.value = "SOPï¼š1.è¯¢é—®ç—‡çŠ¶ 2.æ¨èä¸»è¯ 3.å…³è”ç»´C/ç›Šç”ŸèŒ";
                    updateCharCount('task-action', 200);
                }
            }, 500);
        }

        function resetGenerate() {
            // Hide results
            document.getElementById('generated-result-area').classList.add('hidden');
            // Reset Buttons
            document.getElementById('btn-initial-generate').classList.remove('hidden');
            document.getElementById('btn-group-generated').classList.add('hidden');
            document.getElementById('btn-group-generated').classList.remove('flex');
            // Clear inputs (optional)
            // document.getElementById('ai-input-desc').value = '';
        }

        function saveNewTask() {
            hideCreateTaskView();
            // Reset view for next time
            setTimeout(() => {
                resetGenerate();
                document.getElementById('ai-input-desc').value = '';
                alert('ä»»åŠ¡å·²åˆ›å»ºå¹¶ç”Ÿæ•ˆ');
            }, 300);
        }

        function switchMainTab(tab) {
             const dashboardView = document.getElementById('dashboard-view');
             const profileView = document.getElementById('profile-view');
             const navDashboard = document.getElementById('nav-item-dashboard');
             const navProfile = document.getElementById('nav-item-profile');
             
             if(tab === 'dashboard') {
                 // Show Dashboard
                 dashboardView.classList.remove('hidden');
                 profileView.classList.add('hidden');
                 
                 // Update Navigation
                 navDashboard.classList.add('text-neon-blue');
                 navDashboard.classList.remove('text-slate-500');
                 navProfile.classList.add('text-slate-500');
                 navProfile.classList.remove('text-neon-blue');
             } else if(tab === 'profile') {
                 // Show Profile
                 dashboardView.classList.add('hidden');
                 profileView.classList.remove('hidden');
                 
                 // Update Navigation
                 navDashboard.classList.remove('text-neon-blue');
                 navDashboard.classList.add('text-slate-500');
                 navProfile.classList.remove('text-slate-500');
                 navProfile.classList.add('text-neon-blue');
             }
        }
        
        function handleLogout() {
            if(confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                alert('å·²é€€å‡ºç™»å½•');
                // Here you would typically redirect to login page or clear auth tokens
            }
        }

        // --- Share Modal Logic (Task) ---
        function openTaskShareModal(taskId) {
            const task = supervisionTasks.find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('poster-task-title').innerText = task.title;
            // Mock dynamic SOP based on task description or separate field
            document.getElementById('poster-task-desc').innerText = "1. è¯¢é—®é¡¾å®¢éœ€æ±‚ã€‚\n2. é’ˆå¯¹æ€§æ¨èç›¸å…³äº§å“ã€‚\n3. æé†’ç”¨æ³•ç”¨é‡ã€‚\n(è¯æœ¯ç¤ºä¾‹ï¼šæ­é…è¿™ä¸ªæ•ˆæœæ›´å¥½...)"; 
            document.getElementById('poster-create-time').innerText = task.createTime || '2026-01-13';
            
            document.getElementById('share-task-modal').classList.remove('hidden');
        }

        function closeTaskShareModal() {
            document.getElementById('share-task-modal').classList.add('hidden');
        }

        // --- Share Modal Logic (Case) ---
        function openCaseShareModal() {
            const c = casesData.find(x => x.id === currentCaseId);
            if (!c) return;

            document.getElementById('poster-case-name').innerText = c.name;
            document.getElementById('poster-case-store').innerText = c.store;
            document.getElementById('poster-case-avatar').src = `https://i.pravatar.cc/150?u=${c.id}`;
            document.getElementById('poster-case-duration').innerText = c.duration;
            document.getElementById('poster-case-reason').innerText = c.reason;
            document.getElementById('poster-case-time').innerText = c.startTime;

            // Display complete conversation transcript (all messages)
            const transcriptContainer = document.getElementById('poster-case-transcript');
            transcriptContainer.innerHTML = c.transcript.map(t => `
                <div class="flex items-start space-x-2 mb-2">
                    <div class="font-bold ${t.role === 'staff' ? 'text-neon-blue' : 'text-slate-400'} flex-shrink-0">${t.role === 'staff' ? 'åº—å‘˜' : 'é¡¾å®¢'}:</div>
                    <div class="flex-1">${t.text}</div>
                </div>
            `).join('');

            document.getElementById('share-case-modal').classList.remove('hidden');
        }

        function closeCaseShareModal() {
            document.getElementById('share-case-modal').classList.add('hidden');
        }

        function downloadPoster() {
            alert('æ­£åœ¨ç”Ÿæˆæµ·æŠ¥å›¾ç‰‡å¹¶ä¿å­˜åˆ°æœ¬åœ°...');
        }

        function shareToWeChat() {
            alert('å³å°†æ‰“å¼€å¾®ä¿¡è”ç³»äººåˆ—è¡¨...');
        }
    </script>
</body>
</html>
